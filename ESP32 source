# ESPHome configuration template for controlling a Vent-Axia ventilation unit (e.g. MVHR/HRV)
# This setup uses GPIO pins to activate "Boost" and "Purge" modes, likely via relays connected
# to the unit's switched live inputs or volt-free contacts.
#
# Typical use case:
# - GPIO 19 → Relay for Purge mode (high-speed ventilation to clear air)
# - GPIO 21 → Relay for Boost mode (temporary higher fan speed)
#
# Additionally includes Bluetooth Proxy functionality – useful if your Vent-Axia unit
# (or other devices) uses Bluetooth for control/monitoring.
#
# Adapt GPIO pins, device name, and secrets to your hardware/setup.

substitutions:
  name: vent-axia              # Lowercase name for the device (used in ESPHome)
  friendly_name: Vent Axia     # Human-readable name shown in Home Assistant

esphome:
  name: ${name}
  name_add_mac_suffix: false
  friendly_name: ${friendly_name}
  project:
    name: esphome.ventaxia     # Project name for versioning
    version: "1.0"

esp32:
  board: esp32dev              # Generic ESP32 development board
  framework:
    type: esp-idf              # Recommended framework for better BLE performance

# Home Assistant API (optional encryption – generate a new key with `esphome wizard`)
api:
  encryption:
    key: !secret api_encryption_key   # Generate and store in secrets.yaml

# WiFi configuration – always use secrets for credentials
wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  # Optional: static IP (uncomment and adjust if needed)
  # manual_ip:
  #   static_ip: 192.168.1.100
  #   gateway: 192.168.1.1
  #   subnet: 255.255.255.0

# Logging – VERBOSE is useful during setup, reduce to INFO/DEBUG in production
logger:
  level: VERBOSE

# OTA updates – use a strong password and store it in secrets
ota:
  platform: esphome
  password: !secret ota_password

# Bluetooth Tracker & Proxy – enables active BLE scanning and proxying to Home Assistant
# Useful for integrating Bluetooth-based devices (e.g. some Vent-Axia fans or sensors)
esp32_ble_tracker:
  scan_parameters:
    interval: 1100ms
    window: 1100ms
    active: true

bluetooth_proxy:
  active: true

# Optional: Import the official ESPHome Bluetooth Proxy package (for easy updates)
dashboard_import:
  package_import_url: github://esphome/firmware/bluetooth-proxy/esp32-generic.yaml@main

# Diagnostic button: Safe Mode Boot (helps recover from bad flashes)
button:
  - platform: safe_mode
    name: Safe Mode Boot
    entity_category: diagnostic

# GPIO outputs – these control relays connected to the Vent-Axia unit
output:
  - platform: gpio
    pin: 19                  # Adjust if your relay is on a different pin
    id: purge
    name: "Purge Output"     # Optional: gives a name in logs

  - platform: gpio
    pin: 21                  # Adjust if your relay is on a different pin
    id: boost
    name: "Boost Output"

# Switches exposed to Home Assistant
switch:
  - platform: output
    name: "Vent-Axia Boost"   # Temporary higher fan speed
    output: boost
    icon: "mdi:fan-speed-3"

  - platform: output
    name: "Vent-Axia Purge"   # High-speed purge mode (e.g. for odour/humidity clearing)
    output: purge
    icon: "mdi:weather-windy"
